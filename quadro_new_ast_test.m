m = 1; g = 9.80665; Ixx = 0.1; Iyy = 0.1; Izz = 0.1; psi0 = 0;
x0_0 = [0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0; 0]; 
l = 0.175; b = 26.5e-6; d = 0.6e-6; JTP = 0.005; U0 = [m*g;0;0;0]; w = 2000;
wind = [5;20]; 

[A,B,C,D] = linmod('nonlin_quadro_orig',x0_0,U0);

Bad = zeros(12,2); Bad(2,1) = 1; Bad(6,2) = 1; 
Bw = [B Bad];  

A1 = [0 1 0; 0 0 1; 0 0 -w]; B1 = [0; 0; w];
A2 = [A(1:4,1:4) A(1:4,7:12); A(7:12,1:4) A(7:12,7:12)]; B2 = [B(1:4,2:4);B(7:12,2:4)]; 
Q1 = [100000 0 0; 0 1000 0; 0 0 100000]; R1 = 8000; 

A3 = [0 1 0 0 0; 0 0 9.8 0 0; 0 0 0 1 0; 0 0 0 0 1; 0 0 0 0 -w]; B3 = [0; 0; 0; 0; w]; 
A4 = [A2(3:6,3:6) A2(3:6,9:10);A2(9:10,3:6) A2(9:10,9:10)]; B4 = [B2(3:6,1:1) B2(3:6,3:3); B2(9:10,1:1) B2(9:10,3:3)];
v3 = [100 100 300.5 200 1000 2000]; v4 = [10000 1000000]; 
v5 = [100000 100 150000 1000 1000]; 
Q3 = diag(v5); R3 = 100000;
Q4 = diag(v3); R4 = diag(v4); 

[Kz120,S,e] = lqr(A1,B1,Q1,R1); Kz120 = -Kz120; 
K1z = Kz120(1); K2z = Kz120(2); K0z = Kz120(3); 

[Kt120,S,e] = lqr(A3,B3,Q3,R3); Kt120 = -Kt120; 
K1x = Kt120(1); K2x = Kt120(2); K1t = Kt120(3); K2t = Kt120(4); K0t = Kt120(5); 
[K4,S,e] = lqr(A4,B4,Q4,R4); K4 = -K4;

A1_1 = [0 1; 0 0]; B1_1 = [0; 1]; C1_1 = [1 0]; 
p1 = [-10 -20]; 
H1 = -place(A1_1',-C1_1',p1); H1 = H1'; 
T1 = [B1_1 H1]; 
mz = [K2z (K0z - 1)/1]; nz = K1z; 
M1 = [w*mz*(A1_1-H1*C1_1) w*mz*B1_1 w*mz*H1+w*nz]; 

A1_3 = [0 1 0 0; 0 0 9.8 0; 0 0 0 1; 0 0 0 0]; B1_3 = [0;0;0;1]; C1_3 = [1 0 0 0; 0 0 1 0];
p3 = [-10 -20 -30 -40]; 
H3 = -place(A1_3',-C1_3',p3); H3 = H3';  
T3 = [B1_3 H3]; 
mt = [K2x K1x K2t (K0t - 1)/1]; nt = [K1x K1t];
M3 = [w*mt*(A1_3-H3*C1_3) w*mt*B1_3 w*mt*H3+w*nt];
